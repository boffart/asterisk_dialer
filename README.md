## Системные требования
```
Asterisk 10.9.0
PHP 5.3.29 с поддержкой Curl
Настроить CDR
1C 8.3.10
Apache, для публикации 1С по http
```

## Файл настроек settings.json

* Параметры подключения к АТС
  * "**host**" - адрес сервера Asterisk
  * "**port**" - порт, на котором опубликован AMI
  * "**username**" - имя пользователя AMI
  * "**secret**" - пароль пользователя AMI
* Параметры подключения к 1С:Предприятие
  * "**path_to_1c**" - путь к опубликованному http сервису 1С:Предприятие
  * "**login_1c**" - имя пользователя 1С
  * "**pass_1c**" - пароль пользователя 1С
* Прочие настройки
  * "**yandex_api_key**" - ключ доступа к API от Yandex Cloud API
  * "**speach_dir**" - директория, где будут храниться звуковые файлы
  * "**logfile**" - путь к файлу логов
 
## Установка и настройка 1С на windows

1. Качаем и устанавливаем Apache 2.2
2. Качаем и устанавливаем 1С:Предприятие 8.3 
  * Скачать можно тут https://1c-dn.com
  * (опыты ставить можно на версии для обучения программированию)
  * у версии для обучения есть ограничение на 1 рабочее место. 
3. Запускаем 1С "от имени" Администратора !!!
4. По кнопке "Добавить" создаем новую информационную базу
  * На первом шаге помощника выбираем "Создать новую информационную базу"
  * На втором "Создание новой инф. базы без конфигурации..."
  * Далее указываем имя, к примеру "Автообзвон"
  * Указываем директорию, где будут храниться файлы базы данных
  
5. Открываем информационную базу в режиме "Конфигуратор"
  * В меню "**Администрирование**" - "**Пользователи**" создадим нового пользователя "**testrout**"
  * "**Конфигурация**" - "**Загрузить конфигурацию из файлов**" выберите каталог **cf** текущего репозитория
  * "**Конфигурация**" - "**Обновить конфигурацию базы данных**"
  
6. Необходимо опубликовать http сервисы информационной базы
  * "**Администрирование**" - "**Публикация на web сервере**"
  * Указываем **имя** публикации "**base**"
  * Веб-сервер выбираем Apache 2.2
  * Указываем каталог, где будут храниться файлы публикации 
  * На вкладке "**http сервисы**" выберем "**МИКО_АвтоДозвон**"
  * Осталось только выполнить действие "**Опубликовать**"
  
7. Открываем информационную базу в режиме "1C:Предприятие"
  * На начальной странице отображается таблица - задание на обзвон
  * Для начала звонков необходимо добавить в таблицу новую запись со статусом "В очереди"

## Настройка dialer на АТС
1. Добавляем dialplan в файл /etc/asterisk/extensions.conf, пример доступен в репозитории в одноименном файлеё
2. Копируем файлы dialer в рабочую директорию 
3. Производим настройку settings.json
4. Запускаем скрипт ```starter.php start```
